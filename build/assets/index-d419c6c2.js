import{r,j as e}from"./index-f32d64df.js";import{I}from"./iconify-cb7a1779.js";import{s as O}from"./styled-components.browser.esm-7e11e23d.js";import{a as b,g as A,_ as V,R as g,N as w}from"./request-db53186c.js";import{T as G,I as k}from"./index-3303b122.js";import{I as z}from"./iconify-04245957.js";import{A as J}from"./index-cad7cce6.js";import{m as L}from"./motion-c2cc6a2e.js";import{B as P}from"./button-63286e2e.js";import{M as K,m as W}from"./index-fcab853e.js";import{T as F,a as Q,P as X}from"./index-178d21bb.js";import{h as Y}from"./homeBg-1da15b4d.js";import"./index-0c09f63f.js";import"./useForceUpdate-0fb824c6.js";import"./index-97f61755.js";import"./CheckOutlined-566377ef.js";import"./LeftOutlined-7916e190.js";import"./index-59d990f3.js";import"./Overflow-fc830e4a.js";import"./slide-0918c5e7.js";const Z=a=>b.request({url:"/api/barrage/add/barrage",method:"POST",data:a}),ee=a=>b.request({url:"/api/barrage/barrage/list",method:"GET",params:a}),U=a=>b.request({url:"/api/message/add/message",method:"POST",data:a}),te=a=>b.request({url:"/api/message/get/message",method:"GET",params:a}),se=a=>b.request({url:"/api/message/del/message",method:"POST",data:a}),ae=a=>b.request({url:"/api/message/edit/message",method:"POST",data:a}),H="/assets/textBg-b42c706b.jpg",re=O.div`
  textarea {
    background: url(${H}) 100% 100% no-repeat !important;
    background-size: contain !important;
  }
`;function $(a){const i="https://avatars.githubusercontent.com/u/119206123?s=400&u=c687a9a31da1b18e8b93313bca02766b9478bd50&v=4",[u,c]=r.useState(!1),[f,x]=r.useState(!1),{TreeData:v,success:d}=a,h=JSON.parse(A()),[m,j]=r.useState(""),[l,N]=r.useState(),p=s=>{N(s),c(!0)},S=s=>{N(s),x(!0)},n=async()=>{try{const s=await U({user_id:h.id,parent_id:l.id,username:l.username,avatar:l.avatar,content:m});s.code===g.SUCCESS&&(d(),c(!1),j(""),w({type:"success",msg:s.msg,time:2.5}))}catch(s){console.log(s)}},C=async s=>{try{const y=await se({id:s,is_edit:0});y.code===g.SUCCESS&&(d(),w({type:"success",msg:y.msg,time:2.5}))}catch(y){console.log(y)}},T=async()=>{try{const s=await ae({id:l.id,content:m,username:l.username,avatar:l.avatar});s.code===g.SUCCESS&&(d(),x(!1),j(""),w({type:"success",msg:s.msg,time:2.5}))}catch(s){console.log(s)}};return e.jsxs("div",{className:"w-full h-auto min-h-[12vh]  my-5",children:[v.map(s=>e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"w-full h-[30%] flex justify-between items-center",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{children:e.jsx(J,{shape:"square",size:"large",src:i})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"mx-1 text-[#ef794f] text-lg font-bold",children:s.username}),e.jsx("div",{className:"  text-sm font-bold",children:s.create_at})]})]}),e.jsxs("div",{className:"text-[teal] flex justify-between items-center",children:[h.id===s.user_id?e.jsxs("div",{className:"flex justify-between items-center mr-4",children:[e.jsx("div",{className:"mr-4",children:e.jsx(z,{onClick:()=>S(s),icon:"line-md:edit"})}),e.jsx("div",{children:e.jsx(V,{title:"主儿",description:"确定要删除这个留言吗？",handelConfirm:()=>C(s.id),children:e.jsx(z,{icon:"material-symbols-light:delete"})})})]}):null,e.jsx(L.div,{whileHover:{scale:1.05},whileTap:{scale:.9},transition:{type:"spring",stiffness:500,damping:20},children:e.jsx(P,{onClick:()=>p(s),type:"primary",className:"w-12 h-5  flex justify-center items-center text-sm text-[var(--text-color)] font-bold",size:"large",children:"回复"})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"w-full h-[70%] flex justify-center items-center",children:e.jsxs("div",{className:"  w-[90%] min-h-[70%] py-5 px-4 h-auto break-words  bg-[var(--commentContent)] rounded-xl ",children:[s.parent_id!==0?e.jsxs("span",{className:"text-[#03a9f4] text-sm font-bold pr-1",children:["@",s.username,e.jsx("span",{children:" : "})]}):null,e.jsx("span",{className:" text-sm  break-words text-[#000] whitespace-pre-line",children:s.content})]})}),e.jsx("div",{className:s.parent_id===0?"ml-12":"",children:s.children.length!==0?e.jsx($,{TreeData:s.children,success:d}):null})]})]})),e.jsx(B,{title:"留言",open:u,Confirm:n,Cancel:()=>c(!1),value:m,setValue:j}),e.jsx(B,{title:"修改留言",open:f,Confirm:T,Cancel:()=>x(!1),value:m,setValue:j})]})}const B=a=>{const{title:i,open:u,Confirm:c,Cancel:f,value:x,setValue:v}=a;return e.jsx(K,{cancelText:"取消",okText:"提交",title:i,open:u,onOk:c,onCancel:f,children:e.jsx(re,{children:e.jsx(G,{className:"[&>textarea]:text-[teal] [&>textarea]:font-semibold",rows:6,value:x,onChange:d=>v(d.target.value),placeholder:"咦~ 总想说点什么...",allowClear:!0,showCount:!0,style:{resize:"none"}})})})},ne=O.div`
  textarea {
    background: url(${H}) 100% 100% no-repeat !important;
    background-size: contain !important;
  }
`;function Te(){const a=r.useRef(null),[i,u]=r.useState(""),[c,f]=r.useState(""),{TextArea:x}=k,[v,d]=W.useMessage(),h=JSON.parse(A()),[m,j]=r.useState([]),[l,N]=r.useState([]),[p,S]=r.useState({page:1,page_size:200,count:0}),[n,C]=r.useState({page:1,page_size:10,count:0});r.useEffect(()=>{const t=a.current;if(t){let M=0;const R=setInterval(()=>{const o=document.createElement("div"),E=m[M];o.innerHTML=`
                  <div class='flex  px-1 h-7 rounded-2xl bg-[#000000b2] items-center top-0'>
                            <img
                              src=${E.barrage_avatar?E.barrage_avatar:"https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif?imageView2/1/w/80/h/80"}
                              alt=""
                              class="w-6 mr-2 h-5 rounded-full"
                            />
                            <div class='text-[#fff] pr-1 text-sm'>${E.barrage}</div>
                            </div>
                            `,o.classList.add("barrage_item"),o.style.position="absolute",o.style.animation=`rightToLeft ${Math.floor(Math.random()*20)}s linear both`,t.appendChild(o),console.log(t.clientHeight);const D=t.clientHeight-o.offsetHeight;o.style.top=`${Math.floor(Math.random()*D)}px`,o.addEventListener("animationend",()=>{t.removeChild(o)}),M++,M===m.length&&(S({...p,page:p.page+1}),T())},300);return()=>{clearInterval(R)}}},[m]);const T=async()=>{try{const t=await ee({page:p.page,page_size:p.page_size});t.code===g.SUCCESS&&(j(t.data.data),S({...p,count:t.data.total.count}))}catch(t){console.log(t)}},s=async()=>{try{if(i!==""){if(i.length>=50){v.open({type:"error",content:"谁让你写个留言这么多字，寒寒都装不下了，最多不能超多50个字",className:"custom-class",style:{marginTop:"20vh"}}),u("");return}const t=await Z({barrage:i,barrage_avatar:h.avatar});t.code===g.SUCCESS&&w({type:"error",msg:t.msg,time:2.5}),u("")}else v.open({type:"error",content:"都没写留言，你提交什么？小心我举报你！！",className:"custom-class",style:{marginTop:"20vh"}})}catch(t){console.log(t)}},y=async()=>{try{const t=await U({user_id:h.id,parent_id:0,username:h.username,avatar:h.avatar,content:c});t.code===g.SUCCESS&&(f(""),_(),w({type:"success",msg:t.msg,time:2.5}))}catch(t){console.log(t)}},_=async()=>{try{const t=await te({page:n.page,page_size:n.page_size});t.code===g.SUCCESS&&(N(t.data.data),C({...n,count:t.data.total.count}))}catch(t){console.log(t)}},q=t=>{C({...n,page:t})};return r.useEffect(()=>{_()},[n.page]),r.useEffect(()=>{_(),T()},[]),e.jsxs(ne,{children:[d,e.jsxs("div",{className:"w-full h-auto",children:[e.jsx(F,{children:e.jsxs("div",{className:"h-[100vh] relative bg-[var(--background)] w-full pt-[var(--header)]",children:[e.jsx("img",{src:Y,alt:"",className:"absolute top-0 w-full h-full"}),e.jsx("div",{ref:a,className:"h-full relative SmileySans",children:e.jsxs("div",{className:"md:w-[20vw] w-full  h-[10vh] absolute top-[50%] z-[999] translate-y-[-50%] translate-x-[-50%] left-[50%] flex flex-col justify-center items-center",children:[e.jsx("div",{className:"my-5 text-lg text-[--text-color] font-extrabold",children:"🎉 树洞 🎉"}),e.jsx(k,{onKeyDown:t=>{t.code==="Enter"&&s()},value:i,onChange:t=>u(t.target.value),placeholder:"分享你那些有趣的事",className:"rounded-2xl border-[var(--lightGreen)] w-[80%] h-[40%]",suffix:e.jsx(L.div,{onClick:s,whileHover:{scale:1.2},whileTap:{scale:.9},transition:{type:"spring",stiffness:500,damping:20},children:e.jsx(I,{icon:"ph:radio-button-fill",className:"text-[1.4rem] text-[var(--lightGreen)] "})})})]})})]})}),e.jsxs(Q,{children:[e.jsx("div",{className:"h-auto w-full flex justify-center",children:e.jsxs("div",{className:"md:w-[50%] w-[90%]  h-auto  ",children:[e.jsxs("div",{className:"flex items-center my-5 SmileySans",children:[e.jsx(I,{className:"text-lg text-[teal] mr-1",icon:"simple-line-icons:note"}),e.jsx("div",{className:"text-[teal] text-xl font-extrabold ",children:"留言📩"})]}),e.jsxs("div",{className:"",children:[e.jsx(x,{className:"[&>textarea]:text-[teal] [&>textarea]:font-semibold",rows:6,value:c,onChange:t=>f(t.target.value),placeholder:"咦~ 总想说点什么...",allowClear:!0,showCount:!0,style:{resize:"none"}}),e.jsx("div",{className:"w-full flex md:justify-end justify-center items-center mt-2 ",children:e.jsxs(P,{type:"primary",className:" md:w-40 w-[50%] md:h-8 h-6 m-[12px_0] flex justify-center items-center text-[var(--text-color)] font-bold",shape:"round",size:"large",onClick:y,children:[e.jsx(I,{className:"w-6 h-6 mr-2 text-[--text-color] scale-an",icon:"icon-park-solid:play"}),e.jsx("div",{children:"提交"})]})})]}),e.jsxs("div",{className:"w-full h-auto",children:[e.jsxs("div",{className:"w-full flex SmileySans my-5 justify-start items-center font-bold text-[teal] text-lg",children:[e.jsx("div",{children:" 🎉Comments"}),e.jsx("div",{className:"mx-2",children:" |"}),e.jsxs("div",{children:[e.jsx("span",{children:l.length}),"条留言 🎉"]})]}),e.jsx($,{TreeData:l,success:()=>_()})]})]})}),e.jsx("div",{className:"w-full flex justify-center pb-10",children:e.jsx(X,{onChange:q,current:n.page,total:n==null?void 0:n.count})})]})]})]})}export{Te as default};
//# sourceMappingURL=index-d419c6c2.js.map
